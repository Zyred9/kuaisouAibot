
# 后台统计接口文档

## 概述

本文档描述了快搜AI机器人后台管理系统的统计接口，包括核心业务数据概览、用户增长趋势、财务收支统计、广告投放效果等功能模块。

**基础路径**: `/admin`

**返回格式**: 所有接口均返回统一的`Result<T>`格式

```json
{
  "code": 200,
  "message": "Success",
  "data": { }
}
```

---

## 接口列表

### 1. 获取Dashboard核心指标数据

获取后台管理系统Dashboard所需的核心业务指标数据。

**接口地址**: `GET /admin/dashboard`

**请求参数**: 无

**响应示例**:

```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "totalUsers": 10000,
    "todayNewUsers": 150,
    "activeUsers7d": 3500,
    "activeUsers30d": 8000,
    "totalBalance": 125000.50,
    "todaySearchCount": 5420,
    "totalIncluded": 1200,
    "totalRecharge": 500000.00,
    "todayRecharge": 12500.00,
    "totalWithdrawal": 350000.00,
    "pendingWithdrawals": 25,
    "pendingWithdrawalAmount": 15000.00,
    "totalRevenue": 180000.00,
    "todayRevenue": 4500.00
  }
}
```

**响应字段说明**:

| 字段名 | 类型 | 说明 |
|-------|------|------|
| totalUsers | Long | 用户总数 |
| todayNewUsers | Long | 今日新增用户 |
| activeUsers7d | Long | 7天活跃用户数 |
| activeUsers30d | Long | 30天活跃用户数 |
| totalBalance | BigDecimal | 所有用户总余额(USDT) |
| todaySearchCount | Long | 今日搜索次数 |
| totalIncluded | Long | 收录资源总数 |
| totalRecharge | BigDecimal | 总充值金额 |
| todayRecharge | BigDecimal | 今日充值金额 |
| totalWithdrawal | BigDecimal | 总提现金额 |
| pendingWithdrawals | Long | 待审批提现数量 |
| pendingWithdrawalAmount | BigDecimal | 待审批提现金额 |
| totalRevenue | BigDecimal | 平台总收益(广告收入) |
| todayRevenue | BigDecimal | 今日收益 |

---

### 2. 获取用户增长趋势统计

获取用户增长趋势数据，包括每日新增用户、用户等级分布等信息。

**接口地址**: `GET /admin/user/growth`

**请求参数**:

| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| days | Integer | 否 | 30 | 统计天数 |

**请求示例**:

```
GET /admin/user/growth?days=7
```

**响应示例**:

```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "totalUsers": 10000,
    "weekNewUsers": 450,
    "monthNewUsers": 1800,
    "dailyNewUsers": [
      {
        "date": "2025-01-11",
        "count": 50
      },
      {
        "date": "2025-01-12",
        "count": 65
      },
      {
        "date": "2025-01-13",
        "count": 72
      }
    ],
    "gradeDistribution": {
      "E": 5000,
      "D": 3000,
      "C": 1500,
      "B": 400,
      "A": 100
    }
  }
}
```

**响应字段说明**:

| 字段名 | 类型 | 说明 |
|-------|------|------|
| totalUsers | Long | 总用户数 |
| weekNewUsers | Long | 本周新增用户 |
| monthNewUsers | Long | 本月新增用户 |
| dailyNewUsers | Array | 每日新增用户统计 |
| dailyNewUsers[].date | String | 日期(YYYY-MM-DD) |
| dailyNewUsers[].count | Long | 新增数量 |
| gradeDistribution | Object | 用户等级分布 |
| gradeDistribution.E | Long | E级用户数量 |
| gradeDistribution.D | Long | D级用户数量 |
| gradeDistribution.C | Long | C级用户数量 |
| gradeDistribution.B | Long | B级用户数量 |
| gradeDistribution.A | Long | A级用户数量 |

---

### 3. 获取财务收支统计

获取充值、提现相关的财务统计数据，包括充值趋势、提现趋势、充提差额分析等。

**接口地址**: `GET /admin/finance/stats`

**请求参数**:

| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| days | Integer | 否 | 30 | 统计天数 |

**请求示例**:

```
GET /admin/finance/stats?days=30
```

**响应示例**:

```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "rechargeStats": {
      "totalAmount": 500000.00,
      "totalCount": 2500,
      "todayAmount": 12500.00,
      "todayCount": 65,
      "rechargeUserCount": 1200,
      "avgAmount": 200.00,
      "dailyTrend": [
        {
          "date": "2025-01-11",
          "amount": 10500.00,
          "count": 55
        },
        {
          "date": "2025-01-12",
          "amount": 11200.00,
          "count": 58
        }
      ]
    },
    "withdrawalStats": {
      "totalAmount": 350000.00,
      "totalCount": 1800,
      "todayAmount": 8500.00,
      "todayCount": 42,
      "pendingCount": 25,
      "pendingAmount": 15000.00,
      "successRate": 95.50,
      "avgAmount": 194.44,
      "dailyTrend": [
        {
          "date": "2025-01-11",
          "amount": 7500.00,
          "count": 38
        },
        {
          "date": "2025-01-12",
          "amount": 8200.00,
          "count": 41
        }
      ]
    },
    "balanceAnalysis": {
      "netInflow": 150000.00,
      "rechargeWithdrawRatio": 1.43,
      "retentionRate": 30.00
    }
  }
}
```

**响应字段说明**:

**充值统计(rechargeStats)**:

| 字段名 | 类型 | 说明 |
|-------|------|------|
| totalAmount | BigDecimal | 总充值金额 |
| totalCount | Long | 总充值笔数 |
| todayAmount | BigDecimal | 今日充值金额 |
| todayCount | Long | 今日充值笔数 |
| rechargeUserCount | Long | 充值用户数(去重) |
| avgAmount | BigDecimal | 平均充值金额 |
| dailyTrend | Array | 每日充值趋势 |
| dailyTrend[].date | String | 日期 |
| dailyTrend[].amount | BigDecimal | 金额 |
| dailyTrend[].count | Long | 笔数 |

**提现统计(withdrawalStats)**:

| 字段名 | 类型 | 说明 |
|-------|------|------|
| totalAmount | BigDecimal | 总提现金额(仅成功) |
| totalCount | Long | 总提现笔数(仅成功) |
| todayAmount | BigDecimal | 今日提现金额 |
| todayCount | Long | 今日提现笔数 |
| pendingCount | Long | 待审批数量 |
| pendingAmount | BigDecimal | 待审批金额 |
| successRate | BigDecimal | 成功率(%) |
| avgAmount | BigDecimal | 平均提现金额 |
| dailyTrend | Array | 每日提现趋势 |

**充提差额分析(balanceAnalysis)**:

| 字段名 | 类型 | 说明 |
|-------|------|------|
| netInflow | BigDecimal | 净流入金额(充值-提现) |
| rechargeWithdrawRatio | BigDecimal | 充提比(充值/提现) |
| retentionRate | BigDecimal | 资金留存率(%) |

---

### 4. 获取广告投放效果统计

获取广告投放相关的统计数据，包括广告总览、类型统计、效果分析、收入统计等。

**接口地址**: `GET /admin/adv/stats`

**请求参数**:

| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| days | Integer | 否 | 30 | 统计天数 |

**请求示例**:

```
GET /admin/adv/stats?days=30
```

**响应示例**:

```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "overview": {
      "totalCount": 500,
      "activeCount": 380,
      "endedCount": 100,
      "pendingCount": 20,
      "totalRevenue": 180000.00
    },
    "typeStats": {
      "BUY_KEYWORD_RANK": {
        "advType": "BUY_KEYWORD_RANK",
        "count": 200,
        "revenue": 80000.00,
        "showCount": 150000
      },
      "BUY_TOP_LINK": {
        "advType": "BUY_TOP_LINK",
        "count": 150,
        "revenue": 60000.00,
        "showCount": 200000
      },
      "BUY_BOTTOM_BUTTON": {
        "advType": "BUY_BOTTOM_BUTTON",
        "count": 100,
        "revenue": 30000.00,
        "showCount": 100000
      }
    },
    "effectAnalysis": {
      "totalShowCount": 450000,
      "avgShowCount": 900,
      "topKeywords": [
        {
          "keyword": "电影",
          "purchaseCount": 25
        },
        {
          "keyword": "游戏",
          "purchaseCount": 20
        }
      ],
      "expiringSoonCount": 15
    },
    "revenueStats": {
      "totalRevenue": 180000.00,
      "todayRevenue": 4500.00,
      "weekRevenue": 25000.00,
      "monthRevenue": 85000.00,
      "revenueByType": {
        "BUY_KEYWORD_RANK": 80000.00,
        "BUY_TOP_LINK": 60000.00,
        "BUY_BOTTOM_BUTTON": 30000.00
      },
      "dailyTrend": [
        {
          "date": "2025-01-11",
          "revenue": 3800.00
        },
        {
          "date": "2025-01-12",
          "revenue": 4200.00
        }
      ]
    }
  }
}
```

**响应字段说明**:

**广告总览(overview)**:

| 字段名 | 类型 | 说明 |
|-------|------|------|
| totalCount | Long | 广告总数 |
| activeCount | Long | 活跃广告数(推广中) |
| endedCount | Long | 已结束广告数 |
| pendingCount | Long | 待审批广告数 |
| totalRevenue | BigDecimal | 广告总收入 |

**广告类型统计(typeStats)**:

| 字段名 | 类型 | 说明 |
|-------|------|------|
| advType | String | 广告类型枚举 |
| count | Long | 该类型广告数量 |
| revenue | BigDecimal | 该类型广告收入 |
| showCount | Long | 该类型广告展示次数 |

**广告效果分析(effectAnalysis)**:

| 字段名 | 类型 | 说明 |
|-------|------|------|
| totalShowCount | Long | 广告展示总量 |
| avgShowCount | Long | 平均展示次数 |
| topKeywords | Array | 热门关键词TOP10 |
| topKeywords[].keyword | String | 关键词 |
| topKeywords[].purchaseCount | Long | 购买次数 |
| expiringSoonCount | Long | 7天内即将到期的广告数量 |

**广告收入统计(revenueStats)**:

| 字段名 | 类型 | 说明 |
|-------|------|------|
| totalRevenue | BigDecimal | 总收入 |
| todayRevenue | BigDecimal | 今日收入 |
| weekRevenue | BigDecimal | 本周收入 |
| monthRevenue | BigDecimal | 本月收入 |
| revenueByType | Object | 按类型收入分布 |
| dailyTrend | Array | 每日收入趋势 |
| dailyTrend[].date | String | 日期 |
| dailyTrend[].revenue | BigDecimal | 收入 |

---

## 广告类型枚举说明

| 枚举值 | 说明 |
|--------|------|
| BUY_KEYWORD_RANK | 关键词排行广告 |
| BUY_KEYWORD_PAGE_RANK | 关键词页面排行广告 |
| BUY_BRAND_PAGE_RANK | 品牌页面排行广告 |
| BUY_TOP_LINK | 顶部链接广告 |
| BUY_BOTTOM_BUTTON | 底部按钮广告 |

---

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 500 | 服务器内部错误 |

**错误响应示例**:

```json
{
  "code": 500,
  "message": "获取Dashboard数据失败: 数据库连接超时",
  "data": null
}
```

---

## 注意事项

1. **时间参数**: 所有接口中的`days`参数表示向前统计的天数，默认为30天
2. **金额精度**: 所有金额字段均为`BigDecimal`类型，精度为2位小数
3. **时区**: 所有时间统计基于服务器本地时区
4. **性能考虑**: 建议合理设置`days`参数，避免查询过长时间范围的数据影响性能
5. **权限验证**: 生产环境中应添加适当的权限验证机制

---

## 更新日志

| 版本 | 日期 | 更新内容 |
|------|------|----------|
| 1.0.0 | 2025-01-17 | 初始版本，包含4个统计接口 |

---

## 联系方式

如有问题或建议，请联系开发团队。
